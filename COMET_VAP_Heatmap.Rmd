---
title: "COMET_VAP_DE_Heatmap"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 

```{r}
library(Seurat)
library(SingleCellExperiment)
library(MAST)
library(dplyr)
library(ggplot2)
library(reticulate)
```
```{r ingest count matrix data}
 COMET_Transplant_Tcells <-readRDS('~/Desktop/COMET_Project/Transplant/rObjs/AnnData_Transplant_tcells_051521.rds')
 COMET_Transplant_Tcells.seurat <- as.Seurat(COMET_Transplant_Tcells, counts = "raw_counts", data = "X", assay = "RNA")
 COMET_Transplant_Neut <-readRDS('~/Desktop/COMET_Project/Transplant/rObjs/AnnData_Transplant_Neut_051521.rds')
 COMET_Transplant_Neut.seurat <- as.Seurat(COMET_Transplant_Neut, counts = "raw_counts", data = "X", assay = "RNA")
 COMET_Transplant_Mono <-readRDS('~/Desktop/COMET_Project/Transplant/rObjs/AnnData_Transplant_MonoMac_051521.rds')
 COMET_Transplant_Mono.seurat <- as.Seurat(COMET_Transplant_Mono, counts = "raw_counts", data = "X", assay = "RNA")
```

```{r change levels of idents in Seurat Object to metadata VAP}
Idents(COMET_Transplant_Neut.seurat) <- "VAP"
levels(COMET_Transplant_Neut.seurat)
Idents(COMET_Transplant_Tcells.seurat)<-"VAP"
levels(COMET_Transplant_Tcells.seurat)
Idents(COMET_Transplant_Mono.seurat)<- "VAP"
levels(COMET_Transplant_Mono.seurat)
```
```
```{r load DE results, add directory to DE genes in csv format}
Mono.de.genes <-read.csv()
Neut.de.genes <-read.csv()
Tcells.de.genes <-read.csv()
```

```{r get top 20 genes from mono}
top20_mono <- Mono.de.markers %>% top_n(20,avg_logFC)
head(Mono.de.markers,20)
DE_mono_markers<-c('APOE','APOC1','KCNMA1','MGST3','CCL18','C1QB','C1QC','C1QA','NME2','CAPG','ACP5','B2M','GPNMB','CHI3L1','S100A10','ATP5F1D','SPP1','FBP1','SERPING1','RAC1','CAPG','CFD','ACP5','RNASE1','CTSL','PPP1R15A','SAT1','CXCL8','ZFP36','CD83','FOSB','AC015912.3','CXCL2','IER3','COL6A3','ATP2B1-AS1','KLF6','RPL38','TMSB4X','PHACTR1','NEAT1','AC020916.1','TNFAIP3','RASGEF1B','CCNL1','RPS27','MTRNR2L12','BTG1','ABL2','PHLDA1','AC245014.3','DUSP1')

```

```{r get top 20 genes from neutrophils}
top20_neut <- Neut.de.markers %>% top_n(20,avg_logFC)
head(Neut.de.markers)
DE_neut_markers <-c('S100A11','B2M','S100A6','MYL12A','CKLF','GABARAP','NOP10','ATP5F1E','S100A8','FAU','S100A4','S100A12','SERF2','CST7','CASP4','IFITM1','IFITM3','IFI30','FCGR1A','PLSCR1','CCL4L2','PPP1R15A','IRAK2','CCL3L1','AC020916.1','PHACTR1','CD83','NABP1','RILPL2','CCL4','CCL3','NFKBID','NFKB2','ITGAX','ECE1','IL1RN','AC023157.3','ICAM1','KDM6B','ATG2A','FOSB','RALGDS','TNFAIP2','IVNS1ABP','LPCAT1','TNFAIP3')
```

```{r make a heatmap of DE markers from mono/mac and neut markers}
Mono.Mac.Heatmap <- DoHeatmap(COMET_early_mono, features = DE_mono_markers, group.by = 'VAP', size = 3, group.colors = c('#7CCD7C','#00BFFF')) + NoLegend() + theme(text = element_text(size = 5)) + scale_fill_gradient2(low = '#009ACD', mid = '#F9F4EC', high = '#8B0A50')
ggplot2::ggsave(filename = 'Mono.Mac.Heatmap.png', dpi = 300, plot = Mono.Mac.Heatmap)

Neut.Heatmap <- DoHeatmap(COMET_early_neut, fetures = DE_neut_markers, group.by ='VAP',size = 3, group.colors = c('#7CCD7C','#00BFFF')) + NoLegend() + theme(text = element_text(size = 5)) + scale_fill_gradient2(low = '#009ACD', mid = '#F9F4EC', high = '#8B0A50' )
ggplot2::ggsave(filename = 'Neut.Heatmap.png', dpi = 300, plot = Neut.Heatmap)
```
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Cmd+Option+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Cmd+Shift+K* to preview the HTML file). 

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.

